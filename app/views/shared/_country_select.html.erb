<% parent_region ||= country_code %>
<% country = Carmen::Country.coded(parent_region) %>
<div id="state_code_wrapper">
  <div class="form-group">
    <%= label_tag :country, 'Country', class: 'col-lg-2 control-label' %>
    <div class="col-lg-10">
      <% if country.nil? %>
        <%= country_select owner, :country_code, [], {prompt: 'Please select a country'}, {class: 'form-control'} %>
      <% else %>
        <%= country_select owner, :country_code, [], {selected: parent_region}, {class: 'form-control'} %>
      <% end %>
    </div>
  </div>
  <div class="form-group">
    <%= label_tag :sub_region, 'Province', class: 'col-lg-2 control-label' %>
    <div class="col-lg-10">
      <% if country.nil? %>
        <em>Please select a country above</em>
      <% elsif country.subregions? %>
        <%= subregion_select owner, :state_code, parent_region, {}, {class: 'form-control'} %>
      <% else %>
        <%= text_field owner, :state_code, class: 'form-control' %>
      <% end %>
    </div>
  </div>
</div>